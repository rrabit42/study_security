# Advanced Web Hacking  
보호기법이 적용된 서비스를 분석하고, 우회하여 공격하는 실습  
웹 서비스를 진단하면서 유용하게 사용할 수 있는 도구 소개  

## SQL  
SQL에서는 Data Definition Language(DDL), Data Manipulation Language(DML), Data Control Language(DCL) 총 세 가지 질의 언어 제공  

### Background: Data Manipulation Language(DML). 
데이터베이스에서 데이터를 조회, 추가, 삭제, 수정을 수행하는 구문  
중첩 구문을 쓸 수 있음을 잊지 말자!  
* SELECT  
데이터 조회하는 구문  
* INSERT  
데이터 추가하는 구문  
* UPDATE  
데이터 수정하는 구문  
* DELETE  
데이터 삭제하는 구문  

### Background: SQL Features  
여러 개의 쿼리를 사용하여 데이터를 검색하는 방법, 애플리케이션이 반환하는 결과값을 통해 데이터를 유추하는 방법  
#### **UNION**  
다수의 SELECT 구문의 결과를 결합하는 절  
1. 이전 SELECT 구문과 UNION을 사용한 구문의 실행 결과 중 컬럼의 갯수가 같아야 함  
2. 특정 DBMS에서는 이전 SELECT 구문과 UNION을 사용한 구문의 컬럼 타입(데이터 타입)이 같아야 함.  
```
mysql> SELECT * FROM UserTable UNION SELECT "DreamHack", "DreamHack PW";
/*
+-----------+--------------+
| username  | password     |
+-----------+--------------+
| admin     | admin        |
| guest     | guest        |
| DreamHack | DreamHack PW |
+-----------+--------------+
3 rows in set (0.01 sec)
*/
```  

#### **Subquery**  
한 쿼리 내에 또 다른 쿼리를 사용하는 것 의미  
쿼리 내에서 괄호 안에 구문 삽입해야함. SELECT 구문만 사용 가능  

공격자는 서브 쿼리를 통해 쿼리가 접근하는 테이블이 아닌 다른 테이블에 접근 가능  
SELECT 구문을 사용하지 않는 쿼리문에서 SQL Injection 취약점이 발생할 때 SELECT 구문을 사용할 수 있음  

1. COLUMNS 절에 서브쿼리  
SELECT 구문의 컬럼 절에서 서브쿼리 사용할 때,  
단일 행(Single Row)과 단일 컬럼(Single Column)이 반환되도록 해야함  
```
mysql> SELECT 1,2,3,(SELECT 456); 
/*
+---+---+---+--------------+
| 1 | 2 | 3 | (SELECT 456) |
+---+---+---+--------------+
| 1 | 2 | 3 |          456 |
+---+---+---+--------------+
1 row in set (0.00 sec)
*/
```  

2. FROM 절에 서브쿼리  
인라인 뷰(Inline View)라고 함  
다중 행(Multiple Row)과 다중 컬럼(Multiple Column) 결과를 반환할 수 있음  
```
mysql> SELECT * FROM (SELECT *, 1234 FROM users) as u;
/*
+----------+------+
| username | 1234 |
+----------+------+
| admin    | 1234 |
| guest    | 1234 |
+----------+------+
2 rows in set (0.00 sec)
*/
```  

3. WHERE 절에 서브쿼리  
다중 행 결과를 반환하는 쿼리문 실행 가능  
```
mysql> SELECT * FROM users WHERE username IN (SELECT "admin" UNION SELECT "guest");
/*
+----------+----------+
| username | password |
+----------+----------+
| admin    | admin    |
| guest    | guest    |
+----------+----------+
2 rows in set (0.00 sec)
*/
```  

#### **Application Logic**  
SQL Injection은 애플리케이션 내부에서 사용하는 데이터베이스의 데이터를 조작하는 기법  
쿼리의 실행 결과가 애플리케이션에서 보여지지 않는다면 공격자는 데이터베이스의 정보를 추측하기 어려움  
그러나 데이터 베이스 결과에 따라 어플리케이션은 각기 다른 기능을 수행하므로  
-> 공격자는 참과 거짓을 구분하여 공격을 수행할 수 있음.  

* SQL에서는 IF 문을 사용해 비교 구문 만들 수 있음  
해당 구문을 통해 관리자의 계정의 비밀번호를 한 글자씩 알아낼 수 있음.  
```substr``` 함수 이용  
> ```UNION SELECT IF(substr(password,1,1) ='B', 'admin', 'not admin') from users where username='admin' -- ```  
> if ( 조건문, 참일때 값, 거짓일때 값); 문제에서 admin이 select 되면 true 리턴하게 때문에 참일 때 값을 어쨌든 admin을 준 것  

## ExploitTech: Blind SQL Injection Advanced  

## ExploitTech: Error & Time based SQL Injection  




